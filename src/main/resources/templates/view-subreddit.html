<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title>Express It SubReddit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <link rel="stylesheet" href="/style.css">
    <style>
        body {
            background-color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container{
            margin-top: 50px;
        }

        .content {
            display: flex;
        }

        .left-div, .right-div {
            padding: 20px;
        }

        .left-div {
            width: 25%;
            background-color: #f5f5f5;
        }

        .right-div {
            width: 75%;
        }

        .navbar {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
        }

        .navbar-nav .nav-link {
            color: #fff;
        }

        .form-control {
            border-radius: 20px;
        }

        .search-button {
            border-radius: 20px;
            background-color: #0079d3;
            color: #fff;
        }

        .button-container img {
            border: 2px solid #fff;
        }

        .left-div button {
            border: none;
            padding: 10px;
            text-align: left;
            cursor: pointer;
        }

        .left-div button:hover {
            background-color: #e0e0e0;
        }

        .strong-text {
            font-weight: bold;
        }

        .left-div a {
            color: #0079d3;
            text-decoration: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 40%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .new-subreddit-name-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .new-subreddit-submit-btn {
            background-color: #0079d3;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .background-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .sub-reddit-name {
            display: flex;
            align-items: center;
            margin-top: -30px; /* Adjust as needed */
            justify-content: space-between;

        }

        .round-image {
            border-radius: 50%;
            width: 120px;
            height: 120px;
            margin-right: 20px;
            object-fit: cover;
            border: 2px solid #ccc;
        }

        .buttons {
            display: flex;
            position: relative;
            top: 38px;
        }

        .round-button {
            border-radius: 20px;
            padding: 10px 15px;
            margin-right: 10px;
            text-decoration: none;
            color: #fff;
        }

        .create-button {
            background-color: #0079d3;
        }

        .bell-icon {
            background-color: #878a8c;
        }

        .joined-button {
            background-color: #0079d3;
        }

        .subRedditPostContainer {
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            margin-top: 10px;
            border-bottom: 1px solid #ccc; /* Border bottom for the card body */
            transition: background-color 0.3s;
        }
        .subRedditPostContainer:hover{
            background-color: #f5f5f5;
        }


        .user-style, .date-style {
            color: #878a8c;
        }

        .body-style {
            color: black;
            text-decoration: none;
            margin-bottom: 10px;
        }
        .body-style:hover{
            text-decoration: none;
        }

        .body-a{
            text-decoration: none;
        }
        .body-a:hover{
            text-decoration: none;
        }

        .media-style {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .vote-section {
            display: flex;
            align-items: center;
        }

        .vote-btn button {
            background-color: transparent;
            border: none;
            cursor: pointer;
        }

        .comment-section {
            display: flex;
            align-items: center;
        }

        .comment-button {
            text-decoration: none;
            color: #0079d3;
        }

        .comment-symbol {
            margin-right: 5px;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .share-button {
            background-color: transparent;
            border: none;
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown-content button {
            background-color: transparent;
            border: none;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            cursor: pointer;
        }

        .joined-button {
            background-color: #ec2c2c;
            border: 0;
        }
        .dropdown-content button:hover {
            background-color: #ddd;
        }

        .subRedditDescriptionContainer {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 4px;
        }

        .action-button {
            background-color: #0079d3;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        @media (min-width: 992px)
        .col-lg-3 {
            max-width: 100%;
        }

        .delete-button {
            background-color: #dc3545;
        }
        h2{
            position: relative;
            top:40px;
        }
        h3{
            font-size: 1.50rem;
        }

        .subreddit-top{
            display: flex;
        }

         .subRedditPostContainer {
             animation: fadeIn 0.5s ease-in-out;
         }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .vote-btn button:hover {
            animation: scaleUp 0.2s ease-in-out;
        }

        @keyframes scaleUp {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .comment-button:hover {
            animation: bounce 0.3s ease-in-out;
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }

        .sub-info-buttons{
            text-align: center;
            display: flex;
        }
        .card-title {
            margin-bottom: 0;
        }

    </style>
</head>

<body>
<nav class="navbar navbar-expand-md navbar-dark mb-4" style="background-color:black">
    <a href="/feed/all" class="navbar-brand">
        <img src="/redditlogo/lol.png" alt="logo" class="img-fluid" width="60px"
             height="80px"> <span style="padding-left:15px; font-size: 25px">Reddit</span></a>
    <button class="navbar-toggler" data-toggle="collapse" data-target="#responsive"><span
            class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="responsive">
        <ul class="navbar-nav mr-auto text-capitalize">
            <!--            <li class="nav-item"><a href="#modalview" class="nav-link" data-toggle="modal">messages</a></li>-->
        </ul>
        <form action="" class="form-inline ml-auto d-none d-md-block">
            <input type="text" name="search" id="search" placeholder="Search" class="form-control form-control-sm">
            <input type="submit" value="search" class="search-button">
        </form>
        <div class="button-container">
            <div sec:authorize="isAuthenticated()">
                <a th:href="@{'/u/' + ${userDto.username}}">
                    <img th:src="${userDto.getMediaUri()}" alt="" class="rounded-circle ml-3 d-none d-md-block" width="70px" height="70px">
                </a>
            </div>
        </div>
    </div>
</nav>



<div class="content">
    <div class="left-div">
        <a href="/feed/all"><button><i class="fas fa-home"></i> Home</button></a>
        <a href="/feed/all"><button><i class="fas fa-fire"></i> Popular</button></a>
        <a href="/feed/all"><button><i class="fas fa-list"></i> All</button></a>

        <!-- btn to create new community -->
        <button id="myBtn">Create Community</button>
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3 style="color:#81dcbc;text-align:center;">Create a Community</h3>
                <p>Build and grow a community about something you care about. We'll help you set things up.</p>
                <form id="newSubRedditForm" action="/r/sub/new" method="post" onsubmit="return validateSubRedditName()">
                    <input type="text" id="newSubRedditName" name="newSubRedditName" placeholder="Subreddit Name" class="new-subreddit-name-input" minlength="3" maxlength="30" required><br><br>

                    <span id="subredditNameError" style="color: red;"></span>
                    <strong>Some Rules for making a new community</strong>
                    <ul>
                        <li>SubReddit Name must be unique</li>
                        <li>SubReddit Name must should only have alphabets</li>
                        <li>Name should give some idea on what subreddit is about</li>
                        <li>To share explicit content kindly contact the admin</li>
                        <li>You can add other specifications once you enter your subreddit</li>
                    </ul>
                    <button class="new-subreddit-submit-btn" type="submit">Submit</button><br><br>
                </form>
            </div>
        </div>
        <br><br>
        <div class="col-12">
            <div class="left-column">
                <div class="card shadow-sm card-left2 mb-4">
                    <div class="card-body">
                        <h5 class="mb-3 card-title" th:text="${subRedditViewDto.subRedditName}" style="margin: 0">
                            <small><a href="#" class="ml-1"></a></small></h5>
                        <p th:text="${subRedditViewDto.subRedditDescription}"></p>
                        <strong class="strong-text">Subscribed Users: </strong><span th:text="${subRedditViewDto.subscribedUsers}"></span><br><br>
                        <h5 class="mb-3 card-title">SubReddit Rules
                            <small><a href="#" class="ml-1"></a></small></h5>
                        <div class="subRedditRules">
                            <ul>
                                <li th:each="rule : ${subRedditViewDto.rules}" th:text="${rule}" class="rules"></li>
                            </ul>
                        </div>

                        <div th:if="${#authorization.expression('isAuthenticated()')}">
                            <div th:if="${#authentication.principal.username.equals(subRedditViewDto.opUser.username)}">
                                <div class="sub-info-buttons">
                                    <form th:action="@{'/r/update/' + ${subRedditViewDto.subRedditName}}" method="GET" >
                                        <input type="hidden" id="updateSubRedditName" name="subRedditName">
                                        <button type="submit" class="action-button update-button">Update SubReddit</button>
                                    </form>
                                    <br>
                                    <form th:action="@{'/r/delete/' + ${subRedditViewDto.subRedditName}}" method="POST">
                                        <input type="hidden" id="deleteSubRedditName" name="subRedditName">
                                        <button type="submit" class="action-button delete-button">Delete SubReddit</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card card-left1 mb-4">
                    <div class="card-body text-center ">
                        <img th:src="${userDto.getMediaUri()}" alt="img" width="120px" height="120px" class="rounded-circle mt-n5">
                        <h5 class="card-title" th:text="'u/'+${userDto.username}"></h5>
                        <p class="card-text text-justify mb-2"></p>
                        <ul class="list-unstyled nav justify-content-center">
                            <p href="#" class="text-dark text-decoration-none">
                                <li class="nav-item"><br>
                            <span href="#" class="text-dark text-decoration-none" th:text="'joined on '+${userDto.joined.getMonth()}+' ' + ${userDto.joined.getYear()}" style="margin: 0"></span>
                            <strong th:text="'karma: '+${userDto.karma}"></strong>
                            <div class="button-container">
                                <div sec:authorize="isAuthenticated()">
                                    <form action="#" th:action="@{/logout}" method="post">
                                        <input type="submit" class="button" value="Logout">
                                    </form>
                                </div>
                                <div sec:authorize="!isAuthenticated()">
                                    <a th:href="@{/login}" class="button">Login</a>
                                </div>
                            </div>
                            <a th:href="@{/post/new}" class="button">Create</a>
                        </ul>
                    </div>
                </div>
                <div class="card shadow-sm card-left2 mb-4">
                    <div class="card-body">
                        <h5 class="mb-3 card-title">SubReddits
                            <small><a href="#" class="ml-1"></a></small></h5>
                        <a th:href="@{/r/form/new}" class="new-subreddit-button" style="margin-bottom: 10px"> + New SubReddit</a>
                        <div th:each="subReddit : ${subReddits}" class="subreddit-container">
                            <img th:src="'/feed/image/'+${subReddit.avatar}" alt="img" width="55px" height="55px" style="object-fit: cover" class="rounded-circle mr-3">
                            <a class="card-text, subreddit-link" th:text="'r/'+${subReddit.subRedditName}" th:href="@{'/r/' + ${subReddit.subRedditName}}"
                               style="font-size: 24px"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="right-div">
        <img th:src="@{'/feed/image/' + ${subRedditViewDto.getBanner()}}" class="background-image" alt="set banner">

        <div class="sub-reddit-name">
            <div class="subreddit-top">
                <img th:src="@{'/feed/image/' + ${subRedditViewDto.getAvatar()}}" alt="Round Image" class="round-image">
                <h2 th:text="'r/'+${subRedditViewDto.subRedditName}"></h2>
            </div>
            <div class="buttons">
                <a href="/post/new" class="round-button create-button">
                    <i class="fas fa-plus-circle"></i> Create
                </a>
                <a href="#" class="round-button bell-icon">
                    <i class="fas fa-bell"></i>
                </a>
<!--                <a href="#" class="round-button joined-button">Joined</a>-->
                <form th:action="@{'/r/updatejoinstatus/' + ${subRedditViewDto.subRedditName}}" method="post">
                    <button type="submit"
                            class="round-button joined-button"
                            th:text="${subRedditViewDto.isSubscribed ? 'Joined' : 'Join'}">
                    </button>
                </form>
            </div>
        </div>

        <div class="container">
            <div class="innerLeftContainer">
                <div class="subRedditPostContainer" th:each="post : ${subRedditViewDto.subRedditPostDtos}">
                    <p>
                        <span th:text="'u/'+${post.opUser != null ? post.opUser.username : 'Devesh'}" class="user-style"></span>
                        <span> - </span>
                        <span th:text="${post.createdAt}" class="date-style"></span>
                    </p>
                    <h3 th:text="${post.title}"></h3>
                    <a th:href="'/r/' + ${subRedditViewDto.getSubRedditName()} + '/comments/' + ${post.postId}" class="body-a">
                        <div th:if="${post.body != null}">
                            <p th:utext="${post.body}" class="body-style"></p>
                        </div>
                    </a>
                    <div th:if="${post.mediaUri != null}">
                        <img th:src="${post.mediaUri}" alt="Media" class="media-style">
                    </div>
                    <div class="vote-section">
                        <div class="post-actions">
                            <form th:action="@{/r/voting}" method="post" class="vote-btn">
                                <input type="hidden" name="votetype" th:value="UPVOTE">
                                <input type="hidden" name="postId" th:value="${post.postId}">
                                <button type="submit"><i class="fas fa-arrow-up"></i></button>
                            </form>
                            <p id="voteCount" th:text="${post.voteCount}"/>
                            <form th:action="@{/r/voting}" method="post" class="vote-btn">
                                <input type="hidden" name="votetype" th:value="DOWNVOTE">
                                <input type="hidden" name="postId" th:value="${post.postId}">
                                <button><i class="fas fa-arrow-down"></i></button>
                            </form>
                        </div>
                    </div>

                    <div class="comment-section">
                        <a th:href="@{'/r/'+${subRedditViewDto.subRedditName}+'/comments/'+${post.postId}}" class="comment-button">
                            <span class="comment-symbol"><i class="far fa-comment"></i></span>
                            <span th:text="${post.commentCount}" class="comment-count"></span>
                        </a>
                    </div>

                    <div class="dropdown">
                        <button onclick="toggleDropdown(this)" class="share-button">
                            <i class="fas fa-share"></i> Share
                        </button>
                        <div id="dropdownContent" class="dropdown-content">
                            <button onclick="copyUrl(this, '${post.shareLink}')">Copy URL</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function toggleDropdown(button) {
        var dropdownContent = button.nextElementSibling;
        dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
    }

    function copyUrl(button, url) {
        navigator.clipboard.writeText(url)
            .then(function() {
                console.log('URL copied successfully');
                var dropdownContent = button.parentNode.getElementsByClassName("dropdown-content")[0];
                dropdownContent.style.display = "none";
            })
            .catch(function(error) {
                console.error('Error copying URL: ', error);
            });
    }

    var modal = document.getElementById("myModal");
    var btn = document.getElementById("myBtn");
    var span = document.getElementsByClassName("close")[0];
    btn.onclick = function() {
      modal.style.display = "block";
    }
    span.onclick = function() {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    /*<![CDATA[*/
    var previousSubRedditNames = /*[[${subRedditViewDto.previousSubRedditNames}]]*/ [];

    function validateSubRedditName() {
        var newSubRedditName = document.getElementById("newSubRedditName").value;

        if (previousSubRedditNames.includes(newSubRedditName)) {
            document.getElementById("subredditNameError").innerText = "Subreddit name already exists!";
            return false; // Prevent form submission
        }
        return true; // Allow form submission
    }
    /*]]>*/

</script>
</body>
</html>
